<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8">
  <title>HUDS Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <style>
    /* Hide scrollbar but keep functionality */
    #grid::-webkit-scrollbar { display: none; }
    #grid { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Desktop: no body overflow, mobile: allow scroll */
    @media (min-width: 768px) {
      body { overflow: hidden; }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 h-full flex flex-col">
  <div class="flex-1 flex flex-col max-w-7xl mx-auto w-full p-4">
    <header class="flex items-center justify-between gap-4 mb-4 shrink-0">
      <div>
        <h1 class="text-2xl font-semibold">HUDS Weekly Menu</h1>
        <div class="text-sm text-gray-500">Upperclassmen Houses â€¢ Lunch & Dinner</div>
      </div>
      <div class="flex items-center gap-2">
        <button
          id="refreshBtn"
          class="px-3 py-2 rounded-xl bg-black text-white text-sm hover:bg-gray-800"
          hx-post="/api/refresh"
          hx-trigger="click"
          hx-swap="none"
          hx-on::after-request="htmx.ajax('GET','/api/week_fragment',{target:'#grid',swap:'outerHTML'})"
        >Refresh</button>
      </div>
    </header>

    <!-- Status banners -->
    {% if banner %}
      <div class="mb-3 p-3 rounded-xl text-sm shrink-0 {{ 'bg-red-50 text-red-800' if banner.kind=='error' else 'bg-yellow-50 text-yellow-800' }}">
        {{ banner.text }}
      </div>
    {% endif %}

    <!-- Horizontal scrollable week view with navigation -->
    <div class="relative flex-1 flex items-center gap-2">
      <!-- Left nav button (desktop only) -->
      <button 
        id="prevBtn"
        class="hidden md:flex shrink-0 w-12 h-12 items-center justify-center rounded-full bg-white border-2 border-gray-300 hover:bg-gray-100 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-lg z-10"
        onclick="scrollDays(-1)"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>

      {{ grid|safe }}

      <!-- Right nav button (desktop only) -->
      <button 
        id="nextBtn"
        class="hidden md:flex shrink-0 w-12 h-12 items-center justify-center rounded-full bg-white border-2 border-gray-300 hover:bg-gray-100 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-lg z-10"
        onclick="scrollDays(1)"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
    </div>

    <script>
      let currentDayIndex = 0;
      const grid = document.getElementById('grid');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      
      function updateButtons() {
        const days = grid.querySelectorAll('.snap-start');
        const maxIndex = days.length - 1;
        
        if (prevBtn) prevBtn.disabled = currentDayIndex <= 0;
        if (nextBtn) nextBtn.disabled = currentDayIndex >= maxIndex;
      }
      
      function scrollDays(direction) {
        const days = grid.querySelectorAll('.snap-start');
        currentDayIndex = Math.max(0, Math.min(days.length - 1, currentDayIndex + direction));
        
        if (days[currentDayIndex]) {
          days[currentDayIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
        }
        updateButtons();
      }
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          e.preventDefault();
          scrollDays(-1);
        } else if (e.key === 'ArrowRight') {
          e.preventDefault();
          scrollDays(1);
        }
      });
      
      // Initialize buttons
      updateButtons();
      
      // Update on scroll
      if (grid) {
        grid.addEventListener('scroll', () => {
          const days = grid.querySelectorAll('.snap-start');
          const scrollLeft = grid.scrollLeft;
          const dayWidth = days[0]?.offsetWidth || 0;
          currentDayIndex = Math.round(scrollLeft / dayWidth);
          updateButtons();
        });
      }
    </script>
  </div>
</body>
</html>
